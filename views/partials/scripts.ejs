<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.8/angular.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
<script src="/scripts/nv.d3.min.js"></script>
<script>
	var weatherData = '', displayData = '';
	function unxConverter(ele) {
		var unxdate = $(ele).text();
		var date = new Date(unxdate*1000);
		var hours = date.getHours();
		var mins = date.getMinutes();
		var newDate = Number.parseInt(hours)+10 + ":" + mins; 
		$(ele).text(newDate);
	}
	function getForecast(callback) {
		$.get("/forecast/lae", function (data) {
			callback(data);
		})
	}
	
	function createGraph() {
		nv.addGraph(function() {
			var chart = nv.models.lineChart()
				.margin({left: 100})
				// .userInteractiveGuideline(true)
				// .transitionDuration(350)
				.showLegend(true)
				.showYAxis(true)
				.showXAxis(true);
			chart.xAxis
				.axisLabel("Time (ms)")
				.tickFormat(d3.format(',r'));
			chart.yAxis
				.axisLabel("Voltage (v)")
				.tickFormat(d3.format('.02f'));
			var lineChart = d3.select("#forecastGraph").append("svg");
			lineChart.datum(displayData)
				.call(chart);
		});
	}
	function sortWeatherData() {
		var threeHourly = [];
		for (var i=0; i<weatherData.list.length; i++) {
			// threeHourly.push({x: i, y: weatherData.list[i].temp.day});
			threeHourly.push({x: weatherData.list[i].dt, y: weatherData.list[i].temp.day});
		}
		return [{
			values: threeHourly,
			key: 'Date',
			color: 'cadetblue'
		}];
	}
	$(document).ready(function() {
		getForecast(function(data){
			data ? displayData = sortWeatherData() : console.log(data);
			createGraph();
			// weatherData = data;
			console.log(data);
			// return data;
		})
	});
</script>